#!/bin/bash
# Call the scaler for Retina displays. We only want to scale up when using the
# Retina display as our primary device.
die() {
    test "$1" == "" || echo "$1"
    exit 1
}

xrandr | egrep -q '^\s+2880x1800'
test $? -eq 0 || die "No Retina resolution found."

CHROMEPID=$(ps aux | egrep "^$USER\s.*google.*chrome" | awk '{print $2}' | sort | head -n1)
test "$CHROMEPID" == "" || kill "$CHROMEPID"

xrandr | egrep '^DP-[0-9]\s+connected' &> /dev/null
if [ $? -eq 0 ]; then
    echo "Scaling small."
    scale small
else
    echo "Scaling large."
    scale large
fi

test "$CHROMEPID" == "" || exec google-chrome
