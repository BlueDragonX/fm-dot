#!/bin/bash -u
# Call the scaler for Retina displays. We only want to scale up when using the
# Retina display as our primary device.
retina_res="(2880x1800|2560x1600)"

die() {
	test "$1" == "" || echo "$1"
	exit 1
}

retina=$(xrandr | egrep "^DP-[0-9] connected.*\b${retina_res}\b" | sed 's/ .*//g')
thunderbolt=$(xrandr | egrep "^DP-[0-9] connected\b" | egrep -v "$retina_res" | sed 's/ .*//g')
netbook=$(xrandr | egrep "^LVDS")

if [ -n "$thunderbolt" ]; then
	test -n "$retina" && xrandr --output "$retina" --off
	xrandr --output DP-3 --primary
	xrandr --output DP-4 --auto --left-of DP-3
	trackpad off
	xsetmap poker
	scale small
	echo "Onboard peripherals disabled."
elif [ -n "$netbook" ]; then
	xsetmap acer
	scale tiny
	echo "Onboard peripherals enabled."
else
	xsetmap apple
	scale large
	echo "Onboard peripherals enabled."
fi

dconf write /org/gnome/settings-daemon/plugins/keyboard/active false
i3-msg restart
