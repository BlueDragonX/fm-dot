#!/bin/bash -u
# Call the scaler for Retina displays. We only want to scale up when using the
# Retina display as our primary device.
retina_res="(2880x1800|2560x1600)"

die() {
	test "$1" == "" || echo "$1"
	exit 1
}

retina=$(xrandr | egrep "^eDP-[0-9] connected.*\b${retina_res}\b" | sed 's/ .*//g')
thunderbolt=$(xrandr | egrep "^DP-[0-9] connected\b" | egrep -v "$retina_res" | sed 's/ .*//g')
hdmi=$(xrandr | egrep "^HDMI-[0-9] connected\b" | egrep -v "$retina_res" | sed 's/ .*//g')
netbook=$(xrandr | egrep "^LVDS")

if [ -n "$thunderbolt" ]; then
	xrandr --output "$retina" --auto
	xrandr --output DP-2 --auto --primary --right-of eDP-1
	xsetmap poker
	scale small
	echo "Thunderbolt enabled. Scale is small."
elif [ -n "$hdmi" ]; then
	xrandr --output "$retina" --auto
	xrandr --output HDMI-1 --auto --primary --right-of eDP-1
	xsetmap quickfire
	scale small
	echo "HDMI enabled. Scale is small"
elif [ -n "$netbook" ]; then
	xsetmap acer
	scale tiny
	echo "Onboard screen enabled. Scale is tiny."
else
	xsetmap apple
	scale large
	echo "Onboard screen enabled. Scale is large."
fi

dconf write /org/gnome/settings-daemon/plugins/keyboard/active false
i3-msg restart
